<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<link href="http://api.mobilis.co.kr/webfonts/css/?fontface=NanumGothicWeb" rel="stylesheet" type="text/css">
		<link href="http://fonts.googleapis.com/css?family=Lato:900" rel="stylesheet" type="text/css">        
		<style type="text/css">
			#screen {height:400px;width:450px;overflow-x:hidden;overflow-y:hidden;overflow-y:scroll;padding:4px; border:1 solid #000000;}
			.screen_user {height:20px;width:450px;border:1;background:#fffff;text-align:left;float:left}
			.screen_system {height:20px;border:1;text-align:right;float:right;margin-top:20px;background:#FFEC8B;}
			.guide_label {height:20px;border:1;font-size:7px}
			.guide_label2 {height:20px;width:90px;border:1;font-size:7px;filter:alpha(opacity:.3)}
			.guide_input {height:20px;width:20px;border:2;font-size:7px;background:#fffff}
			#user_message {height:80px;width:300px;background:#0099ff}
			#par {
				position:relative;
			}
			#guide {
				position:absolute;
				left:301px;
				top:0px;
				height:80px;
				width:160px;
				overflow-x:hidden;
				overflow-y:scroll;
				background-image:url('/image/guide.jpg');
				background-size: 160px 80px;
				background-repeat: no-repeat;
			
			}
				
		</style>        
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
		<script type="text/javascript" src="/js/turn.min.js"></script>
		<script>
		    function request(){
		    	
		    	//http://api.geonames.org/citiesJSON?north=44.1&south=-9.9&east=-22.4&west=55.2&lang=de&username=demo
		        //var url = "/test.json?callback=?";
		        //http://61.250.201.170:8182
		        var url = "/rest_object/bill";
		        //var url = "http://192.168.0.10:8080/rest_object/todo";
		        //var url = "http://61.250.201.202:9423/rest_object/todo";
		        //http://192.168.0.10:8080/brower.html
				//url이 localhost는 안먹네? 흠..?
		        $.ajax({
		            type:'POST',
		            url:url,
		            //data:'param='+$('#user_message').val()+'&userId='+$("#user",parent.document).val()+'&userPwd='+encodeURIComponent($("#userPwd",parent.document).val()),
		            data:{param:$('#user_message').val(), userId:$("#user",parent.document).val(),userPwd:$("#userPwd",parent.document).val()},
		            dataType:'json',
		            contentType: "application/json; charset=utf-8",
		            complete:function(){
		            	$('#user_message').val("");
		            	$('#screen').animate({scrollTop:"+=100"},400);
		            },
		            success:function(data){
		            	if(data.status =="로그인실패"){
		            		alert("승인받고오세요");
		            		//window.top.location.href="http://61.250.201.202:9423/index.html";
		            		return;
		            	}else{
		            		$('#guide_text').empty();
		            	}
		            	
		            	var description = data.description;
		            	var content = data.content;
		            	if(content == undefined || content == "undefined"){
		            	}else{
		            		var jsondata = JSON.parse(content);
		            		guide(jsondata);	
		            	}
		            	
		            	if(description == null){
		            		description = "";
		                }
		            	
		            	
		            	$('#screen').append("<label class='screen_system'>"+description+"</label>");
		            	if(data.summary =="" || data.summary == undefined || data.summary == "undefined"){
		            			
		            	}else{
		            		$('#screen').append("<img id='img_guide' src='/image/guide4.jpg' width=20 height=10 class='screen_system' onClick='guide_view(this)' summary="+data.summary+"></p>");
		            	}
		            	
		            	$('#user_message').val("");
		            	$('#screen').animate({scrollTop:"+=100"},400);
		            }
		        });
		    }
		    
		    function guide(data){
		    	$('#guide_text').empty();
		    	var count = 0;
		    	jQuery.each(data,function(index,item){
		    		count++;
		    		var color = "";
		    		if(item.necssary=="true"){
		    			color ="red";
		    		}else{
		    			color ="green";
		    		}
		    		if(item.mapping =="진행"){
		    		}else{
		    			var value = item.value;
		    			var mapping = item.mapping;
		    			if(value =="" && item.mapping=="날짜"){
		    				var now = new Date();
							var year= now.getFullYear();
							var mon = (now.getMonth()+1)>9 ? ''+(now.getMonth()+1) : '0'+(now.getMonth()+1);
							var day = now.getDate()>9 ? ''+now.getDate() : '0'+now.getDate();
							value = year  + mon  + day;
		    			}
		    			var len = value.length;
		    			
		    			if(len > 10) len = 10;
		    			else if(len == 0) len = 3;
		    			
		    			$('#guide_text').append("<label class='guide_label'><font color='"+color+"'>"+item.mapping +"</font></label>");
		    			
		    			$('#guide_text').append("<input size='"+len +"' type='text' name='"+item.mapping+"' value='"+value+"' onkeypress='pasteMessage(event,this)' />");
		    		}
		    	});
		    }
		    
		    //무엇무엇을 입력할지 알려주는 부분.
		    function pasteMessage(e,obj){
		    	if(e.which == 13){
		    		var user_message = "";
		    		$('#guide_text').children().each(function(i){
		    			var value = "";
		    			var obj = $(this); 
		    			if(obj.is(":text")){
		    				value = ":"+obj.val()+",";
		    			}else{
		    				value = obj.text();
		    				
		    			}
		    			
		    			user_message = user_message +value; 
		    			
		    		});
		    		
		    		
		    		user_message = user_message.replace("서비스:","");
		    		
		    		$('#user_message').val(user_message);
		    		$('#user_message').focus();
	            }
		    	
		    	 
		    	 
		    }
		    
		    function readData(){
		        var org = $('#screen').html();
		        var addText = $('#user_message').val();
		        $('#screen').append("<label class='screen_user'>"+addText +"</label></p>");
		        $('#screen').animate({scrollTop:"+=100"},400);
		        $('#user_message').val("");
		    }
		    
		    //프로젝트이름등 여러가지 정보리스트를 보이게하는 부분.
		    function guide_view(obj){
		    	$('#guide').empty();
		    	var obj_summary = $(obj).attr('summary');
		    	
		    	var data = JSON.parse($(obj).attr('summary'));
		    	
		    	
		    	jQuery.each(data,function(index,item){
		    		//var str = item.title.split(",");
		    		
		    		$('#guide').attr('title',item.title);
		    		if(item.guide == undefined){
		    		}else{
		    			
			    		$('#guide').append("<label class='guide_label2'>"+item.guide +"</label></br>");	
		    		}
		    		
		    	});
		    	
		    	$('.guide_label2').dblclick(function() {
		    		var that = $(this)
	    			var title = that.parent().attr('title');
		    		var value = that.text();
	    			if(title =="서비스"){
	    				$('#user_message').val(value);
	    				
	    				var press = jQuery.Event("keypress");
	    				press.ctrlKey = false;
	    				press.which = 13;
	    				
	    				$('#user_message').trigger(press);
	    			}else{
	    				$('#guide_text').find('input[type=text]').each(function(){
	    					var obj = $(this);
	    					var guide_name = obj.attr("name");
	    					if(guide_name == title){
	    						obj.val(value);
	    						obj.focus();
	    					}
	    					
	    				});
	    			}
	    			
	    		});
		    }
		   
		    $(document).ready(function(){
		        $('#user_message').live('keypress',function(e){
		            if(e.which == 13){
		                request();
		                readData();
		            }
		        });
		    });
		
		</script>
</head>
<body>
<div id="screen" name="screen"></div>
<div id="par"><textarea id="user_message" cols="30"></textarea><div id="guide" name="guide"></div></div>

<div id="guide_text" name="guide_text"></div>

</body>

</html>